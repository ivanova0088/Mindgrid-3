<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MindGrid â€“ Ø´Ø¨ÙƒØ© Ø§Ù„Ø¹Ù‚ÙˆÙ„</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00bcd4">
<link rel="apple-touch-icon" href="assets/apple-touch-icon.png">
<style>
:root {
  --primary: #00bcd4;
  --ink: #0b0f14;
  --bg1: #061018;
  --bg2: #081a24;
  --tile: rgba(255,255,255,.06);
  --border: rgba(255,255,255,.12);
  --white: #ffffff;
  --black: #000000;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;font-family: system-ui, -apple-system, "Noto Sans Arabic", Arial, sans-serif;color:#eaf6fb;
  background: radial-gradient(1200px 700px at 10% 10%, #0a2430, transparent 60%),
              radial-gradient(900px 700px at 90% 20%, #042b36, transparent 55%),
              linear-gradient(135deg, var(--bg1), var(--bg2));
  background-attachment: fixed;
  animation: hue 20s linear infinite; 
}
@keyframes hue { from{filter:hue-rotate(0deg)} to{filter:hue-rotate(10deg)} }

header{
  position:sticky;top:0;z-index:5;
  background: linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,0));
  backdrop-filter: blur(6px);
  padding:14px 16px; display:flex; align-items:center; gap:12px;
  border-bottom: 1px solid var(--border);
}
.logo{width:36px;height:36px;border-radius:10px;background:#0fd0e6;display:grid;place-items:center;color:#00151a;font-weight:900}
h1{margin:0;font-size:18px}
main{padding:18px;max-width:1100px;margin:auto}

.card{
  border:1px solid var(--border);
  background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
  border-radius:16px; padding:16px; box-shadow: 0 8px 24px rgba(0,0,0,.25);
}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
@media (max-width:720px){ .grid-3,.grid-4{grid-template-columns:1fr 1fr} }

button,.btn,select,input{
  border-radius:12px;border:1px solid var(--border);background:var(--tile);color:#eaf6fb;
  padding:10px 14px;outline:none
}
button,.btn{cursor:pointer}
.btn-primary{background:linear-gradient(180deg,#12d8f3,#06b6d4); color:#00232b; font-weight:800; border:none}
.btn-ghost{background:transparent}
.section-title{margin:0 0 10px 0;font-size:18px}

.screen{display:none}
.active{display:block}

/* Topics pills */
.pills{display:flex;flex-wrap:wrap;gap:10px}
.pill{
  padding:10px 12px;border-radius:999px;border:1px solid var(--border);
  background:rgba(255,255,255,.05);cursor:pointer;user-select:none
}
.pill.active{background:linear-gradient(180deg,#12d8f3,#06b6d4); color:#00232b; border:none; font-weight:800}

/* Crossword 9x9 */
.cw-wrap{padding:14px}
.cw-grid{
  display:grid; grid-template-columns: repeat(9, 44px); gap:6px; justify-content:center;
}
.cw-cell{
  width:44px;height:44px;border-radius:8px;background:rgba(255,255,255,.08);
  border:2px solid rgba(255,255,255,.2); box-shadow: inset 0 2px 0 rgba(255,255,255,.06);
  display:grid;place-items:center;
}
.cw-input{
  width:100%;height:100%;background:transparent;border:none;color:#eaf6fb;
  text-align:center;font-weight:800;font-size:18px;outline:none;
}
.cw-input:focus{
  box-shadow: 0 0 0 3px rgba(0,188,212,.35) inset, 0 0 0 2px #00bcd4; border-radius:8px;
}
.cw-black{background:#00151a;border-color:#00151a}

/* Forms */
label{font-size:13px;opacity:.9}
.input, .select{width:100%}
.help{opacity:.8;font-size:12px}
hr.sep{border:0;border-top:1px solid var(--border);margin:16px 0}
</style>
</head>
<body>
<header>
  <div class="logo">MG</div>
  <h1>MindGrid â€“ Ø´Ø¨ÙƒØ© Ø§Ù„Ø¹Ù‚ÙˆÙ„</h1>
</header>

<main>
  <!-- Users -->
  <section id="userScreen" class="screen active">
    <div class="card">
      <div class="row" style="justify-content:space-between">
        <h2 class="section-title">Ø§Ø®ØªØ± Ù…Ø³ØªØ®Ø¯Ù…Ù‹Ø§ Ø£Ùˆ Ø£Ø¶Ù Ø­Ø³Ø§Ø¨Ù‹Ø§ Ø¬Ø¯ÙŠØ¯Ù‹Ø§</h2>
        <button class="btn-primary" onclick="showAddUser()">Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…</button>
      </div>
      <div id="userList" class="grid-3"></div>
    </div>
  </section>

  <!-- Add User (onboarding) -->
  <section id="addUserScreen" class="screen">
    <div class="card">
      <h2 class="section-title">Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h2>
      <div class="grid-2">
        <div>
          <label>Ø§Ù„Ø§Ø³Ù…</label>
          <input class="input" type="text" id="name" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ">
        </div>
        <div>
          <label>Ø§Ù„Ø¯ÙˆÙ„Ø©</label>
          <input class="input" id="countryInput" list="countryList" placeholder="Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆÙ„Ø©">
          <datalist id="countryList"></datalist>
        </div>
        <div>
          <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label>
          <input class="input" type="date" id="dob">
          <div class="help">Ù†Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù…Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ Ù„Ø¶Ø¨Ø· Ø­Ø¬Ù… Ø§Ù„Ø®Ø·.</div>
        </div>
        <div>
          <label>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©</label>
          <select id="difficulty" class="select">
            <option value="Ø³Ù‡Ù„">Ø³Ù‡Ù„</option>
            <option value="Ù…ØªÙˆØ³Ø·">Ù…ØªÙˆØ³Ø·</option>
            <option value="ØµØ¹Ø¨" selected>ØµØ¹Ø¨</option>
          </select>
        </div>
      </div>

      <hr class="sep">

      <h3 class="section-title">Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„Ù…ÙØ¶Ù„Ø©</h3>
      <div id="topics" class="pills">
        <!-- Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯Ù‡Ø§ Ø¨Ø±Ù…Ø¬ÙŠÙ‹Ø§ -->
      </div>

      <div class="row" style="margin-top:14px;justify-content:flex-end">
        <button class="btn" onclick="showScreen('userScreen')">Ø¥Ù„ØºØ§Ø¡</button>
        <button class="btn-primary" onclick="saveUser()">Ø­ÙØ¸</button>
      </div>
    </div>
  </section>

  <!-- Games menu -->
  <section id="gamesScreen" class="screen">
    <div class="card">
      <h2 class="section-title">Ø§Ø®ØªØ± Ø§Ù„Ù„Ø¹Ø¨Ø©</h2>
      <div class="grid-3">
        <button class="btn-primary" onclick="startCrossword()">ğŸ§© ÙƒÙ„Ù…Ø§Øª Ù…ØªÙ‚Ø§Ø·Ø¹Ø©</button>
        <button class="btn">ğŸ§  Ø£Ù„ØºØ§Ø² Ù…Ù†Ø·Ù‚ÙŠØ©</button>
        <button class="btn">ğŸ” ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</button>
        <button class="btn">ğŸ”¤ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø­Ø±ÙˆÙ</button>
        <button class="btn">â±ï¸ ØªØ­Ø¯ÙŠ Ø§Ù„Ø³Ø±Ø¹Ø©</button>
        <button class="btn">ğŸ“š Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</button>
        <button class="btn">ğŸ–¼ï¸ ØªØ­Ø¯ÙŠ Ø§Ù„ØµÙˆØ±</button>
      </div>
      <div class="row" style="margin-top:12px">
        <button class="btn" onclick="showScreen('userScreen')">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</button>
      </div>
    </div>
  </section>

  <!-- Crossword 9x9 -->
  <section id="crosswordScreen" class="screen">
    <div class="card">
      <h2 class="section-title" id="cw-question">ÙƒÙ„Ù…Ø§Øª Ù…ØªÙ‚Ø§Ø·Ø¹Ø© (9Ã—9)</h2>
      <div class="cw-wrap">
        <div class="cw-grid" id="cwGrid"></div>
      </div>
      <div class="row" style="justify-content:center">
        <button class="btn" onclick="backToGames()">Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
      </div>
    </div>
  </section>
</main>

<script>
let users = JSON.parse(localStorage.getItem('mg_users')||'[]');
let puzzles = {};
let countries = [];

const ALL_TOPICS = [
  "Ø£Ù„ØºØ§Ø² Ø°ÙƒØ§Ø¡","Ø«Ù‚Ø§ÙØ© Ø¹Ø§Ù…Ø©","ØªØ§Ø±ÙŠØ®","Ø¬ØºØ±Ø§ÙÙŠØ§","Ø¹Ù„ÙˆÙ…","ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§",
  "Ø±ÙŠØ§Ø¶Ø©","ÙÙ†","Ù…ÙˆØ³ÙŠÙ‚Ù‰","Ø£Ø¯Ø¨","Ø£ÙÙ„Ø§Ù… ÙˆÙ…Ø³Ù„Ø³Ù„Ø§Øª","Ø£Ø¹Ù…Ø§Ù„","Ø·Ø¹Ø§Ù…","Ø³ÙØ±","Ø·Ø¨ÙŠØ¹Ø©"
];

// ===== UI helpers =====
function showScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}
function renderUsers(){
  const box = document.getElementById('userList');
  box.innerHTML = users.map(u => `
    <div class="card">
      <div class="row" style="justify-content:space-between;align-items:center">
        <div>
          <div style="font-weight:800">${u.name||"Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"}</div>
          <div style="opacity:.8;font-size:12px">${u.country||"â€”"} â€¢ ${u.age? (u.age+" Ø³Ù†Ø©"):"â€”"}</div>
        </div>
        <div class="row">
          <button class="btn-primary" onclick="enterAs('${u.id}')">Ø¯Ø®ÙˆÙ„</button>
          <button class="btn" onclick="deleteUser('${u.id}')">Ø­Ø°Ù</button>
        </div>
      </div>
    </div>
  `).join('');
}
function enterAs(id){
  localStorage.setItem('mg_active', id);
  showScreen('gamesScreen');
}

function deleteUser(id){
  users = users.filter(u=>u.id!==id);
  localStorage.setItem('mg_users', JSON.stringify(users));
  renderUsers();
}

function uid(){ return 'u_'+Math.random().toString(36).slice(2,9); }

// ===== Onboarding =====
function showAddUser(){
  buildTopics();
  showScreen('addUserScreen');
}

function buildTopics(){
  const host = document.getElementById('topics'); host.innerHTML='';
  ALL_TOPICS.forEach(t=>{
    const b = document.createElement('div');
    b.className = 'pill'; b.textContent = t;
    b.onclick = ()=> b.classList.toggle('active');
    host.appendChild(b);
  });
}

function computeAge(dobStr){
  if(!dobStr) return 0;
  const d = new Date(dobStr); const now = new Date();
  let age = now.getFullYear()-d.getFullYear();
  const m = now.getMonth()-d.getMonth();
  if(m<0 || (m===0 && now.getDate()<d.getDate())) age--;
  return Math.max(0, age);
}

function saveUser(){
  const name = document.getElementById('name').value.trim();
  const country = document.getElementById('countryInput').value.trim();
  const dob = document.getElementById('dob').value;
  const age = computeAge(dob);
  const difficulty = document.getElementById('difficulty').value;
  const topics = Array.from(document.querySelectorAll('#topics .pill.active')).map(x=>x.textContent);

  const u = { id: uid(), name, country, dob, age, difficulty, topics, coins:0, streak:0 };
  users.push(u);
  localStorage.setItem('mg_users', JSON.stringify(users));
  renderUsers();
  showScreen('userScreen');
}

// ===== Crossword 9x9 =====
function startCrossword(){
  const q = puzzles.crossword && puzzles.crossword[0];
  document.getElementById('cw-question').textContent = q ? q.question : "ÙƒÙ„Ù…Ø§Øª Ù…ØªÙ‚Ø§Ø·Ø¹Ø© (9Ã—9)";
  const grid = document.getElementById('cwGrid');
  grid.innerHTML = '';
  for(let i=0;i<81;i++){
    const cell = document.createElement('div'); cell.className='cw-cell';
    const input = document.createElement('input'); input.className='cw-input'; input.maxLength=1;
    input.autocapitalize='none'; input.autocomplete='off'; input.spellcheck=false; input.inputMode='text';
    input.addEventListener('input', (e)=>{
      e.target.value = e.target.value.replace(/\s/g,'');
      const next = e.target.parentElement.nextElementSibling;
      if(e.target.value && next){ const ni = next.querySelector('input'); if(ni) ni.focus(); }
    });
    input.addEventListener('keydown', (e)=>{
      if(e.key==='Backspace' && !e.target.value){
        const prev = e.target.parentElement.previousElementSibling;
        if(prev){ const pi = prev.querySelector('input'); if(pi){ pi.focus(); pi.value=''; } }
      }
    });
    cell.appendChild(input); grid.appendChild(cell);
  }
  showScreen('crosswordScreen');
}

function backToGames(){ showScreen('gamesScreen'); }

// ===== Data loading =====
fetch('puzzles.json').then(r=>r.json()).then(d=>{ puzzles=d||{}; });
fetch('countries.json').then(r=>r.json()).then(list=>{
  countries = list||[];
  const dl = document.getElementById('countryList');
  dl.innerHTML = countries.map(c=>`<option value="${c}">`).join('');
});

// ===== boot =====
renderUsers();

// Service Worker
if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }
</script>
</body>
</html>
